<div
  class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-6 cursor-pointer group"
  (click)="mediaClicked.emit()"
>
  <div class="sm:w-2/5 md:w-1/3 lg:w-1/4 xl:w-1/5 shrink-0">
    <div class="relative rounded-lg overflow-hidden aspect-video">
      @if (isPriority()) {
      <img
        [ngSrc]="thumbnailUrl()"
        [alt]="mediaTitle()"
        width="480"
        height="270"
        priority
        class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-300 ease-in-out"
      />
      } @else {
      <img
        [ngSrc]="thumbnailUrl()"
        [alt]="mediaTitle()"
        width="480"
        height="270"
        class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-300 ease-in-out"
      />
      }
      <div class="absolute inset-0 bg-black bg-opacity-10"></div>
      @if (progress() > 0) {
      <div class="absolute bottom-0 left-0 w-full h-1 bg-zinc-700/80">
        <div class="h-full bg-red-600" [style.width.%]="progress()"></div>
      </div>
      } @if (item().media.media_type === 'movie') {
      <span
        class="absolute bottom-2 right-2 bg-black/60 backdrop-blur-sm text-white text-xs font-semibold px-2 py-1 rounded-md transition-opacity duration-200 group-hover:opacity-0"
        >MOVIE</span
      >
      } @else {
      <span
        class="absolute bottom-2 right-2 bg-black/60 backdrop-blur-sm text-white text-xs font-semibold px-2 py-1 rounded-md transition-opacity duration-200 group-hover:opacity-0"
        >TV SHOW</span
      >
      }
      <div
        class="pointer-events-none absolute right-1 top-1 z-10 flex flex-col space-y-1 transition-opacity duration-200 opacity-0 group-hover:opacity-100 group-hover:pointer-events-auto"
      >
        <button
          (click)="toggleWatchlist($event)"
          class="flex items-center justify-center rounded-full bg-black/60 text-white backdrop-blur-sm transition-colors hover:bg-black/80 h-9 w-9"
          [title]="
            isOnWatchlist() ? 'Remove from Watchlist' : 'Add to Watchlist'
          "
        >
          <span
            class="material-symbols-outlined text-lg"
            [class.material-symbols-filled]="isOnWatchlist()"
            >watch_later</span
          >
        </button>
        <button
          (click)="openPlaylistModal($event)"
          class="flex items-center justify-center rounded-full bg-black/60 text-white backdrop-blur-sm transition-colors hover:bg-black/80 h-9 w-9"
          [title]="isInPlaylist() ? 'Saved to playlist' : 'Save to playlist'"
        >
          <span class="material-symbols-outlined text-lg">{{
            isInPlaylist() ? "playlist_add_check" : "playlist_add"
          }}</span>
        </button>
      </div>
    </div>
  </div>
  <div class="sm:w-3/5 md:w-2/3 lg:w-3/4 xl:w-4/5">
    <div class="flex items-start justify-between">
      <h3
        class="text-white font-semibold text-lg leading-snug group-hover:text-red-500 transition-colors line-clamp-2 pr-2"
        [title]="mediaTitle()"
      >
        {{ mediaTitle() }}
      </h3>
      <div class="relative">
        <button
          (click)="toggleOptionsMenu($event)"
          class="text-zinc-400 hover:text-white p-1 -mr-1 opacity-0 group-hover:opacity-100 transition-opacity shrink-0"
          title="More options"
        >
          <span class="material-symbols-outlined">more_vert</span>
        </button>
      </div>
    </div>

    @if (channelName(); as name) {
    <div
      (click)="onChannelClick($event)"
      class="flex items-center space-x-2 mt-3"
      [class.cursor-pointer]="subscribableChannel()"
    >
      <div
        class="h-6 w-6 rounded-full flex items-center justify-center shrink-0 hover:opacity-80 transition-opacity relative"
        [class.bg-white]="channelLogoUrl()"
        [class.bg-zinc-700]="!channelLogoUrl()"
      >
        @if (channelLogoUrl(); as logoUrl) {
        <img [ngSrc]="logoUrl" [alt]="name" fill class="p-1 object-contain" />
        } @else {
        <span class="text-xs font-bold text-white">{{ name.charAt(0) }}</span>
        }
      </div>
      <p
        class="text-gray-400 text-sm truncate hover:text-white transition-colors"
        [title]="name"
      >
        {{ name }}
      </p>
    </div>
    } @if (overview()) {
    <p class="text-gray-400 text-sm mt-3 line-clamp-2 md:line-clamp-3">
      {{ overview() }}
    </p>
    }
  </div>
</div>
@if (menuStyle(); as style) {
<div
  (click)="$event.stopPropagation()"
  class="fixed w-56 bg-zinc-800 rounded-md shadow-lg z-[100] border border-zinc-700 py-1"
  [style.top]="style.top"
  [style.right]="style.right"
>
  <button
    (click)="toggleWatchlist($event)"
    class="w-full flex items-center space-x-3 px-3 py-2 text-sm text-left text-zinc-200 hover:bg-zinc-700"
  >
    <span
      class="material-symbols-outlined text-xl"
      [class.material-symbols-filled]="isOnWatchlist()"
      >watch_later</span
    >
    <span>{{
      isOnWatchlist() ? "Remove from Watchlist" : "Save to Watchlist"
    }}</span>
  </button>
  <button
    (click)="openPlaylistModal($event)"
    class="w-full flex items-center space-x-3 px-3 py-2 text-sm text-left text-zinc-200 hover:bg-zinc-700"
  >
    <span class="material-symbols-outlined text-xl">{{
      isInPlaylist() ? "playlist_add_check" : "playlist_add"
    }}</span>
    <span>{{ isInPlaylist() ? "Saved to playlist" : "Save to playlist" }}</span>
  </button>
  <div class="border-t border-zinc-700/50 my-1 mx-2"></div>
  <button
    (click)="openDetailsModal($event)"
    class="w-full flex items-center space-x-3 px-3 py-2 text-sm text-left text-zinc-200 hover:bg-zinc-700"
  >
    <span class="material-symbols-outlined text-xl">info</span>
    <span>Details</span>
  </button>
  <button
    (click)="onRemove($event)"
    class="w-full flex items-center space-x-3 px-3 py-2 text-sm text-left text-zinc-200 hover:bg-zinc-700"
  >
    <span class="material-symbols-outlined text-xl">delete</span>
    <span>Remove from history</span>
  </button>
</div>
} @if (showPlaylistModal()) {
<app-add-to-playlist-modal
  [media]="item().media"
  (close)="showPlaylistModal.set(false)"
/>
} @if (showDetailsModal()) {
<app-media-detail-modal
  [media]="item().media"
  (close)="showDetailsModal.set(false)"
/>
}
