<div class="flex flex-col space-y-6 p-4 sm:p-6">
  <div class="flex justify-between items-center">
    <h1 class="text-3xl font-bold text-white">Playlists</h1>
    <button (click)="showCreateForm.set(true)" class="flex items-center space-x-2 bg-zinc-800 text-white hover:bg-zinc-700 active:bg-zinc-600 rounded-full px-4 py-2 text-sm font-semibold">
      <span class="material-symbols-outlined">playlist_add</span>
      <span>New playlist</span>
    </button>
  </div>

  @if (playlists().length > 0) {
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-x-4 gap-y-12 sm:gap-x-6">
      @for(playlist of playlists(); track playlist.id; let i = $index) {
        <div class="relative cursor-pointer group" (click)="onPlaylistClicked(playlist)">
          <div class="relative rounded-xl overflow-hidden aspect-video bg-zinc-800">
            @if (playlist.items.length > 0 && playlist.items[0].backdrop_path) {
              @if (i < 5) {
                <img [ngSrc]="'https://image.tmdb.org/t/p/w780' + playlist.items[0].backdrop_path" [alt]="playlist.name" width="480" height="270" priority class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-300 ease-in-out"/>
              } @else {
                <img [ngSrc]="'https://image.tmdb.org/t/p/w780' + playlist.items[0].backdrop_path" [alt]="playlist.name" width="480" height="270" class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-300 ease-in-out"/>
              }
            } @else {
              <div class="w-full h-full flex items-center justify-center bg-zinc-800">
                <span class="material-symbols-outlined text-5xl text-zinc-600">playlist_play</span>
              </div>
            }
            <div class="absolute inset-0 bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity"></div>
            <div class="absolute inset-y-0 right-0 w-2/5 bg-black/60 flex flex-col items-center justify-center">
              <span class="font-bold text-lg text-white">{{ playlist.items.length }}</span>
              <span class="material-symbols-outlined text-3xl text-white">playlist_play</span>
            </div>
            
            <!-- removed three dots in thumbnail - menu is next to title -->
          </div>
          <div class="mt-3 flex items-start justify-between">
            <h3 class="text-white font-medium text-base leading-snug group-hover:text-red-500 transition-colors line-clamp-2 pr-2" [title]="playlist.name">
              {{ playlist.name }}
            </h3>
            <!-- Three dots next to title like video-card, always visible and slightly larger -->
            <button (click)="togglePlaylistMenu($event, playlist.id)" class="text-zinc-400 hover:text-white p-1 text-xl ml-2" title="Playlist options">
              <span class="material-symbols-outlined">more_vert</span>
            </button>
          </div>
          <p class="text-gray-400 text-sm mt-1">View full playlist</p>
        </div>
      }
    </div>
  } @else {
    <div class="text-center py-16">
      <span class="material-symbols-outlined text-7xl text-zinc-600">playlist_play</span>
      <h2 class="mt-4 text-2xl font-semibold text-zinc-400">No playlists yet</h2>
      <p class="text-zinc-500 mt-2 mb-6">Create a playlist to organize your favorite videos.</p>
      <button (click)="showCreateForm.set(true)" class="bg-white text-black px-5 py-2.5 rounded-full text-sm font-bold hover:bg-zinc-200 uppercase tracking-wider">
        Create Playlist
      </button>
    </div>
  }
</div>

@if (showCreateForm()) {
  <div class="fixed inset-0 bg-black/70 z-40 flex items-center justify-center p-4" (click)="cancelCreate()">
    <div class="bg-zinc-800 rounded-lg shadow-xl w-full max-w-md" (click)="$event.stopPropagation()">
      <div class="flex items-center justify-between p-4 border-b border-zinc-700">
        <h3 class="text-lg font-semibold text-white">New playlist</h3>
        <button (click)="cancelCreate()" class="text-zinc-400 hover:text-white p-1 rounded-full">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      <div class="p-4 flex flex-col space-y-4">
        <input 
          type="text" 
          placeholder="Title"
          [(ngModel)]="newPlaylistName"
          (keyup.enter)="createNewPlaylist()"
          class="w-full bg-zinc-900 border-zinc-700 text-white rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500"
        >
        <textarea 
          placeholder="Description"
          [(ngModel)]="newPlaylistDescription"
          rows="3"
          class="w-full bg-zinc-900 border-zinc-700 text-white rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500"
        ></textarea>
      </div>
      <div class="flex justify-end space-x-2 p-4 bg-zinc-800/50 border-t border-zinc-700">
        <button (click)="cancelCreate()" class="bg-zinc-700 text-white px-4 py-1.5 rounded-full text-sm font-semibold hover:bg-zinc-600">Cancel</button>
        <button (click)="createNewPlaylist()" class="bg-white text-black px-4 py-1.5 rounded-full text-sm font-semibold hover:bg-zinc-200 disabled:opacity-50 disabled:cursor-not-allowed" [disabled]="!newPlaylistName().trim()">Create</button>
      </div>
    </div>
  </div>
}

  @if (playlistMenuStyle(); as style) {
    <ng-container *ngIf="selectedPlaylist() as p">
      <div
        (click)="$event.stopPropagation()"
        class="fixed w-48 bg-zinc-800 rounded-md shadow-lg z-[100] border border-zinc-700 py-1"
        [style.top]="style.top"
        [style.right]="style.right">
        <button (click)="deletePlaylistFromMenu($event, p.id)" class="w-full flex items-center space-x-3 px-3 py-2 text-sm text-left text-zinc-200 hover:bg-zinc-700">
          <span class="material-symbols-outlined text-xl">delete</span>
          <span>Delete Playlist</span>
        </button>
      </div>
    </ng-container>
  }
