<div class="flex flex-col space-y-6 p-4 sm:p-6">
  <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
    <h1 class="text-3xl font-bold text-white">Release Calendar</h1>
    
    <div class="flex flex-wrap items-center gap-2 sm:gap-4">
      <div class="flex items-center space-x-2">
        <select [value]="displayMonth().getMonth()" (change)="onMonthChange($event)" class="bg-zinc-800 text-white rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500 text-sm font-semibold">
            @for(month of availableMonths; track month; let i = $index) {
                <option [value]="i">{{ month }}</option>
            }
        </select>
         <select [value]="displayMonth().getFullYear()" (change)="onYearChange($event)" class="bg-zinc-800 text-white rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500 text-sm font-semibold">
            @for(year of availableYears(); track year) {
                <option [value]="year">{{ year }}</option>
            }
        </select>
      </div>
      <div class="flex items-center space-x-1">
          <button (click)="previousMonth()" class="p-2 rounded-full hover:bg-zinc-800 transition-colors" aria-label="Previous month">
             <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg>
          </button>
          <button (click)="nextMonth()" class="p-2 rounded-full hover:bg-zinc-800 transition-colors" aria-label="Next month">
             <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" /></svg>
          </button>
      </div>
      <button (click)="goToToday()" class="px-4 py-2 border border-zinc-700 text-white text-sm font-semibold rounded-md hover:bg-zinc-800 transition-colors">Today</button>
    </div>
  </div>
  
  <!-- Tabs & Filters -->
  <div class="border-b border-zinc-800">
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 pb-2">
      <!-- Tabs -->
      <div class="flex items-center space-x-2 overflow-x-auto no-scrollbar">
        <button 
          (click)="setMediaType('all')"
          class="px-4 py-2 rounded-full text-sm font-semibold transition-colors shrink-0 whitespace-nowrap"
          [class.bg-white]="activeMediaType() === 'all'"
          [class.text-black]="activeMediaType() === 'all'"
          [class.bg-zinc-800]="activeMediaType() !== 'all'"
          [class.text-white]="activeMediaType() !== 'all'"
          [class.hover:bg-zinc-700]="activeMediaType() !== 'all'">
            All
        </button>
        <button 
          (click)="setMediaType('movie')"
          class="px-4 py-2 rounded-full text-sm font-semibold transition-colors shrink-0 whitespace-nowrap"
          [class.bg-white]="activeMediaType() === 'movie'"
          [class.text-black]="activeMediaType() === 'movie'"
          [class.bg-zinc-800]="activeMediaType() !== 'movie'"
          [class.text-white]="activeMediaType() !== 'movie'"
          [class.hover:bg-zinc-700]="activeMediaType() !== 'movie'">
            Movies
        </button>
         <button 
          (click)="setMediaType('tv')"
          class="px-4 py-2 rounded-full text-sm font-semibold transition-colors shrink-0 whitespace-nowrap"
          [class.bg-white]="activeMediaType() === 'tv'"
          [class.text-black]="activeMediaType() === 'tv'"
          [class.bg-zinc-800]="activeMediaType() !== 'tv'"
          [class.text-white]="activeMediaType() !== 'tv'"
          [class.hover:bg-zinc-700]="activeMediaType() !== 'tv'">
            TV Shows
        </button>
        <button 
          (click)="setMediaType('anime')"
          class="px-4 py-2 rounded-full text-sm font-semibold transition-colors shrink-0 whitespace-nowrap"
          [class.bg-white]="activeMediaType() === 'anime'"
          [class.text-black]="activeMediaType() === 'anime'"
          [class.bg-zinc-800]="activeMediaType() !== 'anime'"
          [class.text-white]="activeMediaType() !== 'anime'"
          [class.hover:bg-zinc-700]="activeMediaType() !== 'anime'">
            Anime
        </button>
      </div>

      <!-- Genre Filter -->
      <select 
          [value]="selectedGenre() || ''"
          (change)="onGenreChange($event)"
          class="bg-zinc-800 text-white rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500 min-w-[150px] text-sm">
          <option value="">All Genres</option>
          @for(genre of availableGenres(); track genre.id) {
            <option [value]="genre.id">{{ genre.name }}</option>
          }
      </select>
    </div>
  </div>

  @if (loading()) {
    <div class="flex justify-center items-center h-96">
      <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-red-500"></div>
    </div>
  } @else {
    <div class="grid grid-cols-7 gap-px bg-zinc-700 border border-zinc-700 rounded-lg overflow-hidden">
      <!-- Day Headers -->
      @for(dayName of ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']; track dayName) {
        <div class="text-center font-bold text-zinc-400 py-2 text-sm bg-zinc-900">
          <span class="hidden md:inline">{{dayName}}</span>
          <span class="md:hidden">{{dayName.slice(0,3)}}</span>
        </div>
      }
      
      <!-- Calendar Days -->
      @for(week of weeks(); track $index) {
        @for(day of week.days; track day.date.toISOString()) {
          <div 
            (click)="openDayDetailModal(day)"
            class="bg-zinc-800/50 min-h-[150px] p-1.5 flex flex-col transition-colors" 
            [class.!bg-zinc-900]="day.date.getMonth() === displayMonth().getMonth()"
            [class.hover:bg-zinc-700/50]="day.releases.length > 0"
            [class.cursor-pointer]="day.releases.length > 0">
            <p 
              class="font-bold text-right text-xs w-6 h-6 flex items-center justify-center rounded-full ml-auto" 
              [class.bg-red-600]="isToday(day.date)"
              [class.text-white]="day.date.getMonth() === displayMonth().getMonth()" 
              [class.text-zinc-500]="day.date.getMonth() !== displayMonth().getMonth()">
              {{ day.date | date:'d' }}
            </p>
            <div class="flex-grow flex flex-col space-y-1 mt-1 overflow-hidden">
              @for(release of day.displayReleases; track release.id) {
                <div (click)="$event.stopPropagation(); onMediaClick(release)" class="cursor-pointer group relative flex items-center space-x-1.5 p-1 rounded hover:bg-zinc-700/50">
                  <div class="w-2 h-2 rounded-full shrink-0" 
                    [class.bg-purple-500]="release.genre_ids.includes(16)"
                    [class.bg-red-500]="!release.genre_ids.includes(16) && release.media_type === 'movie'"
                    [class.bg-blue-500]="!release.genre_ids.includes(16) && release.media_type === 'tv'"></div>
                  <span class="text-xs text-zinc-300 truncate group-hover:text-white">{{ release.media_type === 'movie' ? release.title : release.name }}</span>
                </div>
              }
              @if (day.moreCount > 0) {
                 <div class="text-xs font-semibold text-zinc-400 p-1 rounded hover:bg-zinc-700/50 text-center">+{{ day.moreCount }} more</div>
              }
            </div>
          </div>
        }
      }
    </div>
  }
</div>

@if (selectedDay(); as day) {
  <app-day-detail-modal 
    [day]="day"
    (close)="onCloseDayDetailModal()"
    (mediaClicked)="onMediaClick($event)" />
}

@if (selectedMedia(); as media) {
  <app-media-detail-modal 
    [media]="media"
    (close)="onCloseModal()" />
}
